<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>topos.org.uk - Building CernVM-FS server on Ubuntu</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
    </head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../">topos.org.uk</a>
            </div>
            <div id="navigation">
                <a href="../">Home</a>
                <a href="../about.html">About</a>
                <a href="../contact.html">Contact</a>
                <a href="../archive.html">Archive</a>
            </div>
        </div>

        <div id="content">
            <h1>Building CernVM-FS server on Ubuntu</h1>

            <div class="info">
    Posted on January 24, 2013
    
        by Nick
    
</div>

<p>The past couple of days I’ve been looking at running <a href="http://cernvm.cern.ch/portal/filesystem/">CernVM-FS</a> at work to support our genetic pipelining software. As a first step, I’ve been trying to compile and run a CernVM-FS server on our systems. The details on how exactly to build a ‘Stratum-0’ server aren’t exactly clear, so this is a set of notes of how I managed to get the server up and running.</p>
<!-- more -->

<p>Cern packages the cvmfs server for RHEL, Scientific Linux and even a package for Fedora 17. Unfortunately, most of our infrastructure here is Debian based, and getting hold of a RHEL based VM is slightly tricky, so instead we’re building from source. The comments on the CernVM-FS website seem to suggest that the 2.0 release of the server is somewhat flaky and only works on SL5, so I’m using the 2.1BETA release.</p>
<ol style="list-style-type: decimal">
<li>Install the following packages:
<ul>
<li>libfuse-dev</li>
<li>apache2</li>
<li>attr</li>
</ul></li>
<li>Grab the source from https://ecsft.cern.ch/dist/cvmfs/cvmfs-2.1.5/cvmfs-2.1.5.tar.gz</li>
<li>Extract to a working directory.</li>
<li><code>cmake .</code></li>
<li><code>make</code></li>
<li><code>make install</code></li>
<li>The apache2 configuration requires mod_headers to be enabled, so we enable this now: <code>sudo a2enmod headers</code> and then restart apache: <code>sudo /etc/init.d/apache2 restart</code>.</li>
<li><code>sudo cvmfs_server mkfs test</code> should now work correctly and give the following response: &gt; Creating configuration files… done &gt; Creating CernVM-FS master key for test.repo in /etc/cvmfs/keys/test.repo.pub… done &gt; Creating self-signed certificate for test.repo in /etc/cvmfs/keys/test.repo.crt… done &gt; Create CernVM-FS Storage… done &gt; Create Initial Repository… done &gt; Mounting CernVM-FS Storage… done &gt; Initial commit… New CernVM-FS repository for test.repo &gt; &gt; Before you can install anything, call <code>cvmfs_server transaction</code> &gt; to enable write access on your repository. Then install your &gt; software in /cvmfs/test.repo as user nc6. &gt; Once you’re happy, publish using <code>cvmfs_server publish</code> &gt; &gt; For client configuration, have a look at ‘cvmfs_server info’ &gt; &gt; If you go for production, backup you software signing keys in /etc/cvmfs/keys/!</li>
<li>Begin a transaction using <code>cvmfs_server transaction test.repo</code></li>
<li>At this point, you can drop some data in /cvmfs/test.repo/.</li>
<li><code>cvmfs_server publish test.repo</code></li>
</ol>
<p>You should at this point be able to see the repo in a web browser by browsing to <server address>/cvmfs/test.repo.</p>

<div id="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'categoricalimpredicative'; // Required - Replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
        </div>
        <div id="footer">
            <div style="float:left;">
                Site proudly generated by
                <a href="http://jaspervdj.be/hakyll">Hakyll</a>
            </div>
            <div>
                All work on this site is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 Unported License</a>.
            </div>
        </div>
    </body>
</html>
