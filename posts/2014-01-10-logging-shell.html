<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>topos.org.uk - Tabula: a shell logger</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
    </head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../">topos.org.uk</a>
            </div>
            <div id="navigation">
                <a href="../">Home</a>
                <a href="../about.html">About</a>
                <a href="../contact.html">Contact</a>
                <a href="../archive.html">Archive</a>
            </div>
        </div>

        <div id="content">
            <h1>Tabula: a shell logger</h1>

            <div class="info">
    Posted on January 10, 2014
    
        by Nick
    
</div>

<p>One of the long term goals for my group is to make it easier to reproduce and share not just scientific results, but the analyses that produced them. Having recently been more exposed to the process of manipulating genetic data than previously, it’s become especially clear to me why this is important.</p>
<!-- more -->

<p>A good deal of time was spent doing what is colloquially known as ‘data munging’ - converting between different formats, different reference sequences, different identification nomenclatures. This work is typically done in a terminal and consists of chained invocations of tools such as <code>cut</code>, <code>grep</code>, <code>awk</code>, as well as some specialist tools which are called once the data has been put in the right format. At the end of a couple of weeks of trial and error, I ended up with the output I wanted - along with about 50 intermediate files littered all over the place, little idea of what was in them, and only a vague conception of the process I went through.</p>
<p>In this particular case, I’d been prepared. I also had a notebook full of comments about the actions I’d taken, why I’d taken them and what the results were. In places this was complete, and in places I’d forgotten to take a note of what I was doing and had to reconstruct the steps I took through recollections and searching through various ‘history’ entries.</p>
<p>In case anybody misses where I’m clearly going with this, this is a terrible process and we should be able to do better. The computer knows the precise steps I went through, it knows the ones that succeeded and the ones that failed, it knows where I was when I typed them and what the environment was. With a little bit of prodding, it should be able to make a good guess about what the commands did - if I’m interested in where I got the file ‘foo’ from, and there’s a command in the history where I typed ‘cat bar &gt; foo’, a vaguely intelligent system should be able to suggest that this was what produced ‘foo’. Or, at least, it would know all of this stuff if it didn’t throw it away.</p>
<p>Bash keeps a small amount of the information around in the form of its history. This gives the last 500 or so commands that you typed into a terminal (although it behaves slightly confusingly with multiple terminals on the same machine). It’s pretty poor, though. It’s not possible to find out even when a command was run, so if you’re looking for something you typed in yesterday, the best you can do is assume it’ll be somewhere near the bottom. What we - or I, at least - would like is the following:</p>
<ul>
<li>A list of all the commands I’ve run whilst doing a particular piece of work.</li>
<li>The ability to hide commands that failed, or similar behaviour. For example, if I type in a series of commands that look similar and all but the last fail, I would like to collapse those commands into the last one, since I was probably trying to work out command syntax.</li>
<li>I’d like to know how long things took to run. I’d especially like long running commands which I manually killed half-way through to be flagged.</li>
<li>For each command, where was I and what did the environment look like when I ran it? It’s all very well knowing I ran <code>rm *</code> at some point, but ideally I’d like to know what precisely I was deleting.</li>
<li>If I’ve moved a bunch of directories around, I’d like to easily rewrite old commands to deal with the new directory structure (as best as possible, obviously - this one is a bit more tricky.)</li>
<li>If I’m working on something from multiple terminals, or multiple computers, I’d like to see the aggregate commands from all of those places, preferably in time order, and marked as to where I ran them.</li>
<li>The moon on a stick.</li>
</ul>
<p>This is… surprisingly annoying to do, and in another post I’ll probably go into detail on the various hacky things I’ve found it necessary to use to get this to work, but for now I’ll just share the link to <a href="https://github.com/nc6/tabula">tabula</a>, which is my implementation of a bunch of the above requirements and will hopefully come to embody all of them. It’s in quite an early state, but should be perfectly usable in bash (unfortunately the ways I’ve hooked into bash are quite specific, so it’s locked to that at the moment). On some systems is gives an error on quitting; I’m not entirely certain why.</p>
<p>To use it, just type ‘tabula start’, and you’ll get dropped into a logged session. Job control doesn’t work at the moment, but other things should. When you’re done, a log of everything you’ve worked on should be present at <code>$HOME/.tabula/default</code> in JSON format. Some of the recorded lines are recording the ways tabula itself is hooking in to make a record - these will be removed in future versions.</p>
<p>Anyway, have a play, let me know what you think!</p>

<div id="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'categoricalimpredicative'; // Required - Replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
        </div>
        <div id="footer">
            <div style="float:left;">
                Site proudly generated by
                <a href="http://jaspervdj.be/hakyll">Hakyll</a>
            </div>
            <div>
                All work on this site is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 Unported License</a>.
            </div>
        </div>
    </body>
</html>
